<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–î—ñ–∞–Ω–∞ ‚Äî –ì–æ–ª–æ—Å–æ–≤–∏–π –ø–æ–º—ñ—á–Ω–∏–∫</title>
  <style>
    body { margin: 0; background: #111; color: white; font-family: sans-serif; text-align: center; }
    canvas { display: block; margin: auto; height: 80vh; }
    #status { margin: 10px; font-size: 1.2em; }
  </style>
</head>
<body>
  <h1>–ì–æ–ª–æ—Å–æ–≤–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –î—ñ–∞–Ω–∞</h1>
  <div id="status">üé§ –û—á—ñ–∫—É—é –Ω–∞ –∫–æ–º–∞–Ω–¥—É...</div>
  <canvas id="avatar"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/@readyplayerme/visage@0.1.0-beta.12"></script>
  <script>
    const avatarId = "clwmswzod00bzml0f6ebz8zoc"; // ‚Üê —Ç–≤—ñ–π Avatar ID
    const openaiKey = "sk_live_ffTNEWvztMlnTQeYGHxshMXOe7m9sGICikxd"; // ‚Üê —Ç–≤—ñ–π –∫–ª—é—á

    // 1. Ready Player Me –∞–≤–∞—Ç–∞—Ä
    const canvas = document.getElementById("avatar");
    const renderer = new window.ReadyPlayerMe.Visage(canvas);
    renderer.loadModel(`https://models.readyplayer.me/${avatarId}.glb`);

    // 2. –ì–æ–ª–æ—Å–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—è
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "uk-UA";
    recognition.continuous = false;
    recognition.interimResults = false;

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "uk-UA";
      speechSynthesis.speak(utterance);
    }

    async function askOpenAI(question) {
      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${openaiKey}`
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [{ role: "system", content: "–¢–∏ ‚Äî –¥–∏—Ç—è—á–∏–π –≥–æ–ª–æ—Å–æ–≤–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –î—ñ–∞–Ω–∞, —è–∫–∞ –≥–æ–≤–æ—Ä–∏—Ç—å —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é —Ç–∞ –¥–æ–ø–æ–º–∞–≥–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É, –Ω—ñ–±–∏ –¥–æ–±—Ä–∞ –ø–æ–¥—Ä—É–≥–∞. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –∫–æ—Ä–æ—Ç–∫–æ, –¥—Ä—É–∂–Ω—å–æ —Ç–∞ –∑ –µ–º–æ—Ü—ñ—î—é." },
                     { role: "user", content: question }]
        })
      });
      const data = await res.json();
      return data.choices?.[0]?.message?.content || "–ù–µ —Ä–æ–∑—É–º—ñ—é...";
    }

    recognition.onresult = async (event) => {
      const text = event.results[0][0].transcript;
      document.getElementById("status").textContent = `‚ùì –¢–∏ —Å–∫–∞–∑–∞–≤: ${text}`;
      const answer = await askOpenAI(text);
      speak(answer);
      document.getElementById("status").textContent = `üí¨ –î—ñ–∞–Ω–∞: ${answer}`;
    };

    recognition.onend = () => {
      recognition.start(); // –ë–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–µ —Å–ª—É—Ö–∞–Ω–Ω—è
    };

    recognition.onerror = (event) => {
      document.getElementById("status").textContent = "‚ùå –ü–æ–º–∏–ª–∫–∞ –º—ñ–∫—Ä–æ—Ñ–æ–Ω—É";
      console.error(event.error);
    };

    // –ü–æ—á–∞—Ç–∫–æ–≤–µ –≤—ñ—Ç–∞–Ω–Ω—è
    window.onload = () => {
      speak("–ü—Ä–∏–≤—ñ—Ç! –Ø —Ç–≤—ñ–π –≥–æ–ª–æ—Å–æ–≤–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –î—ñ–∞–Ω–∞");
      recognition.start();
    };
  </script>
</body>
</html>
