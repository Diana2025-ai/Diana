<!DOCTYPE html><html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ì–æ–ª–æ—Å–æ–≤–∏–π –ê—Å–∏—Å—Ç–µ–Ω—Ç –î—ñ–∞–Ω–∞</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 30px; }
    button { font-size: 20px; padding: 10px 20px; }
    #response { margin-top: 20px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>–ê—Å–∏—Å—Ç–µ–Ω—Ç –î—ñ–∞–Ω–∞ ü§ñ</h1>
  <button onclick="startListening()">üéôÔ∏è –ì–æ–≤–æ—Ä–∏—Ç–∏</button>
  <div id="response"></div>  <script>
    const OPENAI_API_KEY = "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";
    let recognition;
    let isSpeaking = false;
    let conversation = [{ role: "system", content: "–¢–∏ ‚Äî –≥–æ–ª–æ—Å–æ–≤–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –î—ñ–∞–Ω–∞. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –∫–æ—Ä–æ—Ç–∫–æ —ñ –¥—Ä—É–∂–Ω—å–æ." }];

    async function startListening() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –º–æ–≤–∏.");
        return;
      }
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'uk-UA';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = async (event) => {
        const transcript = event.results[0][0].transcript.trim();
        addMessage("user", transcript);
        speakText("–î—É–º–∞—é...");

        if (transcript.toLowerCase().includes("–ø–æ–≥–æ–¥–∞")) {
          getWeather();
        } else if (transcript.toLowerCase().includes("–Ω–æ–≤–∏–Ω–∏")) {
          getNews();
        } else {
          const reply = await askGPT(transcript);
          speakText(reply);
          document.getElementById("response").innerText = reply;
        }
      };

      recognition.start();
    }

    function speakText(text) {
      if (isSpeaking) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'uk-UA';
      isSpeaking = true;
      utterance.onend = () => { isSpeaking = false; };
      speechSynthesis.speak(utterance);
    }

    function addMessage(role, content) {
      conversation.push({ role, content });
      if (conversation.length > 10) conversation.splice(1, 1);
    }

    async function askGPT(message) {
      conversation.push({ role: "user", content: message });
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: conversation
        })
      });
      const data = await response.json();
      const reply = data.choices[0].message.content;
      conversation.push({ role: "assistant", content: reply });
      return reply;
    }

    async function getWeather() {
      if (!navigator.geolocation) {
        speakText("–ù–µ–º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é.");
        return;
      }
      navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
        const data = await response.json();
        const temp = data.current_weather.temperature;
        const weather = data.current_weather.weathercode;
        const msg = `–ó–∞—Ä–∞–∑ ${temp} –≥—Ä–∞–¥—É—Å—ñ–≤.`;
        speakText(msg);
        document.getElementById("response").innerText = msg;
      });
    }

    async function getNews() {
      const res = await fetch("https://newsdata.io/api/1/news?apikey=pub_37553093dca2e17f9e947b44d375e6b0d69ae&q=ukraine&language=uk");
      const data = await res.json();
      if (data.results && data.results.length > 0) {
        const headline = data.results[0].title;
        speakText(`–û—Å—å –≥–æ–ª–æ–≤–Ω–∞ –Ω–æ–≤–∏–Ω–∞: ${headline}`);
        document.getElementById("response").innerText = headline;
      } else {
        speakText("–ù–µ–º–∞—î –Ω–æ–≤–∏–Ω –∑–∞—Ä–∞–∑.");
      }
    }
  </script></body>
</html>
