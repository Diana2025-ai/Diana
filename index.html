<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–î—ñ–∞–Ω–∞ ‚Äì –≥–æ–ª–æ—Å–æ–≤–∏–π –ø–æ–º—ñ—á–Ω–∏–∫</title>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; text-align: center; }
    iframe { width: 100%; height: 400px; border: none; margin-top: 10px; }
    #status { margin-top: 10px; font-size: 1.2em; }
  </style>
</head>
<body>
  <h1>–î—ñ–∞–Ω–∞</h1>
  <div id="status">üé§ –°–ª—É—Ö–∞—é —Ç–µ–±–µ...</div>
  <iframe src="https://readyplayer.me/avatar/YOUR_AVATAR_ID?frameApi" allow="camera *; microphone *"></iframe>

  <script>
    const apiKey = 'YOUR_OPENAI_API_KEY';
    const city = "–ù–æ–≤–æ—Å–µ–ª–∏—Ü—è";
    const openWeatherKey = 'YOUR_OPENWEATHER_API_KEY';

    const synth = window.speechSynthesis;
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'uk-UA';
    recognition.interimResults = false;
    recognition.continuous = false;

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'uk-UA';
      utter.pitch = 1.3;
      utter.rate = 1;
      synth.speak(utter);
      utter.onend = () => {
        listen(); // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–æ–≤—Ç–æ—Ä–Ω–µ —Å–ª—É—Ö–∞–Ω–Ω—è –ø—ñ—Å–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
      };
    }

    function listen() {
      document.getElementById('status').innerText = 'üé§ –°–ª—É—Ö–∞—é —Ç–µ–±–µ...';
      recognition.start();
    }

    recognition.onresult = async (event) => {
      const text = event.results[0][0].transcript.trim().toLowerCase();
      document.getElementById('status').innerText = `üëÇ –¢–∏ —Å–∫–∞–∑–∞–≤: ${text}`;
      console.log("–í–∏ —Å–∫–∞–∑–∞–ª–∏:", text);

      if (text.includes("–ø–æ–≥–æ–¥–∞")) {
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${openWeatherKey}&units=metric&lang=ua`;
        const res = await fetch(url);
        const data = await res.json();
        const temp = Math.round(data.main.temp);
        const desc = data.weather[0].description;
        speak(`–ó–∞—Ä–∞–∑ —É ${city} ${desc}, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ${temp} –≥—Ä–∞–¥—É—Å—ñ–≤.`);
        return;
      }

      if (text.includes("–º—É–∑–∏–∫–∞")) {
        speak("–í–º–∏–∫–∞—é —Ç–≤–æ—é —É–ª—é–±–ª–µ–Ω—É –º—É–∑–∏–∫—É!");
        window.open("https://www.youtube.com/results?search_query=—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞+–º—É–∑–∏–∫–∞", "_blank");
        return;
      }

      if (text.includes("–ø—Ä–∏–≤—ñ—Ç") || text.includes("—Ö–∞–π")) {
        speak("–ü—Ä–∏–≤—ñ—Ç! –Ø —Ç–≤—ñ–π –≥–æ–ª–æ—Å–æ–≤–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –î—ñ–∞–Ω–∞. –ß–∏–º –¥–æ–ø–æ–º–æ–≥—Ç–∏?");
        return;
      }

      if (text.includes("—â–æ —Ç–∏ –≤–º—ñ—î—à") || text.includes("–º–æ–∂–µ—à")) {
        speak("–Ø –º–æ–∂—É –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≥–æ–¥—É, –≤–∫–ª—é—á–∏—Ç–∏ –º—É–∑–∏–∫—É –∞–±–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç–∏ –∑ —Ç–æ–±–æ—é.");
        return;
      }

      // –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ ‚Äî –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –¥–æ ChatGPT
      const gptResponse = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [
            { role: "system", content: "–¢–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –¥–∏—Ç—è—á–∏–π –≥–æ–ª–æ—Å–æ–≤–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –î—ñ–∞–Ω–∞. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –ø—Ä–æ—Å—Ç–æ, –¥–æ–±—Ä–æ–∑–∏—á–ª–∏–≤–æ —ñ —Ç—Ä–æ—Ö–∏ –∂–∞—Ä—Ç—É—é—á–∏." },
            { role: "user", content: text }
          ]
        })
      });

      const gptData = await gptResponse.json();
      const reply = gptData.choices[0].message.content;
      speak(reply);
    };

    recognition.onerror = (e) => {
      document.getElementById('status').innerText = "‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞: " + e.error;
      setTimeout(() => listen(), 2000);
    };

    window.onload = () => {
      speak("–ü—Ä–∏–≤—ñ—Ç! –Ø –î—ñ–∞–Ω–∞.");
    };
  </script>
</body>
</html>
